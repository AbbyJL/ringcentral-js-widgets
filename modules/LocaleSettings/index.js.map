{"version":3,"sources":["modules/LocaleSettings/index.js"],"names":["LocaleSettings","name","deps","dep","optional","globalStorage","locale","supportedLocales","options","_globalStorage","_locale","_supportedLocales","_storageKey","registerReducer","key","reducer","actionTypes","pending","ready","store","dispatch","type","init","savedLocale","saveLocale","currentLocale","setLocale","initSuccess","status","state","getItem","s","slice","sort"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;;;AACA;;AACA;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAIA;;AAEA;;;;IAYqBA,c,WARpB,gBAAO;AACNC,QAAM,gBADA;AAENC,QAAM,CACJ,eADI,EAEJ,QAFI,EAGJ,EAAEC,KAAK,uBAAP,EAAgCC,UAAU,IAA1C,EAHI;AAFA,CAAP,C;;;AASC;;;;;AAKA,4BAKQ;AAAA,mFAAJ,EAAI;;AAAA,QAJNC,aAIM,QAJNA,aAIM;AAAA,QAHNC,MAGM,QAHNA,MAGM;AAAA,qCAFNC,gBAEM;AAAA,QAFNA,gBAEM,yCAFa,wBAAcA,gBAE3B;AAAA,QADHC,OACG;AAAA;;AAAA,iLAEDA,OAFC;;AAAA;;AAIN,UAAKC,cAAL,GAAsB,kCAAkBJ,aAAlB,EAAiC,eAAjC,CAAtB;AACA,UAAKK,OAAL,GAAe,kCAAkBJ,MAAlB,EAA0B,QAA1B,CAAf;AACA,UAAKK,iBAAL,GAAyBJ,gBAAzB;AACA,UAAKK,WAAL,GAAmB,oBAAnB;AACA,UAAKH,cAAL,CAAoBI,eAApB,CAAoC;AAClCC,WAAK,MAAKF,WADwB;AAElCG,eAAS,qCAAsB,MAAKC,WAA3B;AAFyB,KAApC;AARM;AAYP;;;;;;;;;;sBAiBG,KAAKC,OAAL,IACA,KAAKR,cAAL,CAAoBS,KADpB,IAEA,KAAKR,OAAL,CAAaQ,K;;;;;AAEb,qBAAKC,KAAL,CAAWC,QAAX,CAAoB;AAClBC,wBAAM,KAAKL,WAAL,CAAiBM;AADL,iBAApB;;oBAGK,KAAKC,W;;;;;AACR,qBAAKC,UAAL,CAAgB,KAAKd,OAAL,CAAae,aAA7B;;;;;sBACS,KAAKF,WAAL,KAAqB,KAAKb,OAAL,CAAae,a;;;;;;uBACrC,KAAKf,OAAL,CAAagB,SAAb,CAAuB,KAAKH,WAA5B,C;;;AAER,qBAAKJ,KAAL,CAAWC,QAAX,CAAoB;AAClBC,wBAAM,KAAKL,WAAL,CAAiBW;AADL,iBAApB;;;;;;;;;;;;;;;;;;;6GAqBarB,M;;;;;;uBACT,KAAKI,OAAL,CAAagB,SAAb,CAAuBpB,MAAvB,C;;;AACN,qBAAKa,KAAL,CAAWC,QAAX,CAAoB;AAClBC,wBAAM,KAAKL,WAAL,CAAiBQ,UADL;AAElBlB;AAFkB,iBAApB;;;;;;;;;;;;;;;;;;wBAlDiB;AACjB,aAAO,8DACF,gDADE,IAEL,YAFK,IAGJ,gBAHI,CAAP;AAID;;;wBAEa;AACZ,aAAO,4BAAgB;AACrBsB,gBAAQ,sCAAuB,KAAKZ,WAA5B;AADa,OAAhB,CAAP;AAGD;;;wBAsBY;AACX,aAAO,KAAKa,KAAL,CAAWD,MAAlB;AACD;;;wBAEiB;AAChB,aAAO,KAAKnB,cAAL,CAAoBqB,OAApB,CAA4B,KAAKlB,WAAjC,CAAP;AACD;;;;;;;;WAGkB,8BACjB;AAAA,aAAM,OAAKD,iBAAX;AAAA,KADiB,EAEjB;AAAA,aAAKoB,EAAEC,KAAF,GAAUC,IAAV,EAAL;AAAA,KAFiB,C;;;kBAnEAjC,c","file":"index.js","sourcesContent":["import defaultConfig from 'locale-loader/defaultConfig';\nimport { createSelector } from 'reselect';\nimport { combineReducers } from 'redux';\nimport RcModule from '../../lib/RcModule';\nimport Enum from '../../lib/Enum';\nimport moduleActionTypes from '../../enums/moduleActionTypes';\nimport proxify from '../../lib/proxy/proxify';\nimport { Module } from '../../lib/di';\nimport ensureExist from '../../lib/ensureExist';\nimport getter from '../../lib/getter';\nimport getModuleStatusReducer from '../../lib/getModuleStatusReducer';\nimport {\n  getSavedLocaleReducer,\n} from './reducers';\n\n/* eslint-disable global-require */\n\n/**\n * @class\n * @description Locale managing module\n */\n@Module({\n  name: 'LocaleSettings',\n  deps: [\n    'GlobalStorage',\n    'Locale',\n    { dep: 'LocaleSettingsOptions', optional: true }\n  ]\n})\nexport default class LocaleSettings extends RcModule {\n  /**\n   * @constructor\n   * @param {Object} params - params object\n   * @param {String} params.defaultLocale - default 'en-US'\n   */\n  constructor({\n    globalStorage,\n    locale,\n    supportedLocales = defaultConfig.supportedLocales,\n    ...options\n  } = {}) {\n    super({\n      ...options,\n    });\n    this._globalStorage = this::ensureExist(globalStorage, 'globalStorage');\n    this._locale = this::ensureExist(locale, 'locale');\n    this._supportedLocales = supportedLocales;\n    this._storageKey = 'localeSettingsData';\n    this._globalStorage.registerReducer({\n      key: this._storageKey,\n      reducer: getSavedLocaleReducer(this.actionTypes),\n    });\n  }\n\n  get _actionTypes() {\n    return new Enum([\n      ...Object.keys(moduleActionTypes),\n      'saveLocale',\n    ], 'localeSettings');\n  }\n\n  get reducer() {\n    return combineReducers({\n      status: getModuleStatusReducer(this.actionTypes),\n    });\n  }\n\n  async _onStateChange() {\n    if (\n      this.pending &&\n      this._globalStorage.ready &&\n      this._locale.ready\n    ) {\n      this.store.dispatch({\n        type: this.actionTypes.init,\n      });\n      if (!this.savedLocale) {\n        this.saveLocale(this._locale.currentLocale);\n      } else if (this.savedLocale !== this._locale.currentLocale) {\n        await this._locale.setLocale(this.savedLocale);\n      }\n      this.store.dispatch({\n        type: this.actionTypes.initSuccess,\n      });\n    }\n  }\n\n  get status() {\n    return this.state.status;\n  }\n\n  get savedLocale() {\n    return this._globalStorage.getItem(this._storageKey);\n  }\n\n  @getter\n  supportedLocales = createSelector(\n    () => this._supportedLocales,\n    s => s.slice().sort(),\n  );\n\n  @proxify\n  async saveLocale(locale) {\n    await this._locale.setLocale(locale);\n    this.store.dispatch({\n      type: this.actionTypes.saveLocale,\n      locale,\n    });\n  }\n}\n"]}