{"version":3,"sources":["modules/Contacts/index.js"],"names":["DefaultContactListPageSize","Contacts","deps","dep","optional","auth","listPageSize","contactSources","options","actionTypes","_auth","ensureExist","_reducer","_contactSources","_sourcesLastStatus","_sourcesUpdatedAt","Date","now","_listPageSize","source","addSource","addSelector","size","_checkSourceUpdated","names","AllContactSourceName","keys","sourceName","get","sourceReady","push","contacts","concat","filteredContacts","pageNumber","pageSize","count","items","slice","groups","searchFilter","sourceFilter","allContacts","store","subscribe","_onStateChange","_shouldInit","dispatch","type","initSuccess","_shouldReset","_resetModuleStatus","loggedIn","sourceModuleReady","pending","ready","resetSuccess","updateFilter","Error","has","getPresence","getProfileImage","matchPhoneNumber","set","updated","lastStatus","data","phoneNumber","result","phoneNumbers","forEach","id","contactId","toString","find","x","contact","useCache","sync","state","status","_selectors","sourceNames","contactGroups","RcModule","proxify"],"mappings":"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","file":"index.js","sourcesContent":["import RcModule from '../../lib/RcModule';\nimport { Module } from '../../lib/di';\nimport ensureExist from '../../lib/ensureExist';\nimport isBlank from '../../lib/isBlank';\nimport {\n  uniqueContactItems,\n  sortContactItemsByName,\n  groupByFirstLetterOfName,\n  filterContacts,\n  AllContactSourceName,\n} from '../../lib/contactHelper';\nimport proxify from '../../lib/proxy/proxify';\nimport actionTypes from './actionTypes';\nimport getContactsReducer from './getContactsReducer';\n\nexport const DefaultContactListPageSize = 20;\n\n/**\n * @class\n * @description Contacts managing module\n */\n@Module({\n  deps: [\n    'Auth',\n    { dep: 'ContactSources', optional: true },\n    { dep: 'ContactsOptions', optional: true }\n  ]\n})\nexport default class Contacts extends RcModule {\n  /**\n   * @constructor\n   * @param {Object} params - params object\n   * @param {Auth} params.auth - auth module instance\n   */\n  constructor({\n    auth,\n    listPageSize = DefaultContactListPageSize,\n    contactSources = [],\n    ...options,\n  }) {\n    super({\n      ...options,\n      actionTypes,\n    });\n    this._auth = this::ensureExist(auth, 'auth');\n    this._reducer = getContactsReducer(this.actionTypes);\n    this._contactSources = new Map();\n    this._sourcesLastStatus = new Map();\n    this._sourcesUpdatedAt = Date.now();\n    this._listPageSize = listPageSize;\n\n    for (const source of contactSources) {\n      this.addSource(source);\n    }\n\n    this.addSelector(\n      'sourceNames',\n      () => this._contactSources.size,\n      () => this._checkSourceUpdated(),\n      () => {\n        const names = [AllContactSourceName];\n        for (const sourceName of Array.from(this._contactSources.keys())) {\n          const source = this._contactSources.get(sourceName);\n          if (source.sourceReady) {\n            names.push(sourceName);\n          }\n        }\n        return names;\n      }\n    );\n\n    this.addSelector(\n      'allContacts',\n      () => this._checkSourceUpdated(),\n      () => {\n        let contacts = [];\n        for (const sourceName of Array.from(this._contactSources.keys())) {\n          const source = this._contactSources.get(sourceName);\n          if (source.sourceReady) {\n            contacts = contacts.concat(source.contacts);\n          }\n        }\n        return contacts;\n      }\n    );\n\n    this.addSelector(\n      'contactGroups',\n      () => this.filteredContacts,\n      () => this.pageNumber,\n      (filteredContacts, pageNumber) => {\n        const pageSize = this._listPageSize;\n        const count = pageNumber * pageSize;\n        let items = uniqueContactItems(filteredContacts);\n        items = sortContactItemsByName(items);\n        items = items.slice(0, count);\n        const groups = groupByFirstLetterOfName(items);\n        return groups;\n      }\n    );\n\n    this.addSelector(\n      'filteredContacts',\n      () => this.searchFilter,\n      () => this.sourceFilter,\n      () => this._checkSourceUpdated(),\n      (searchFilter, sourceFilter) => {\n        let contacts;\n        if (\n          isBlank(searchFilter) &&\n          (sourceFilter === AllContactSourceName || isBlank(sourceFilter))\n        ) {\n          return this.allContacts;\n        }\n        if (sourceFilter !== AllContactSourceName && !isBlank(sourceFilter)) {\n          const source = this._contactSources.get(sourceFilter);\n          if (source && source.sourceReady) {\n            /* eslint { \"prefer-destructuring\": 0 } */\n            contacts = source.contacts;\n          } else {\n            contacts = [];\n          }\n        } else {\n          contacts = this.allContacts;\n        }\n        if (!isBlank(searchFilter)) {\n          contacts = filterContacts(contacts, searchFilter);\n        }\n        return contacts;\n      }\n    );\n  }\n\n  initialize() {\n    this.store.subscribe(() => this._onStateChange());\n  }\n\n  _onStateChange() {\n    if (this._shouldInit()) {\n      this.store.dispatch({\n        type: this.actionTypes.initSuccess,\n      });\n    } else if (this._shouldReset()) {\n      this._resetModuleStatus();\n    }\n  }\n\n  _shouldInit() {\n    return (\n      this._auth.loggedIn &&\n      this.sourceModuleReady &&\n      this.pending\n    );\n  }\n\n  _shouldReset() {\n    return (\n      (\n        !this._auth.loggedIn ||\n        !this.sourceModuleReady\n      ) &&\n      this.ready\n    );\n  }\n\n  _resetModuleStatus() {\n    this.store.dispatch({\n      type: this.actionTypes.resetSuccess,\n    });\n  }\n\n  @proxify\n  updateFilter({ sourceFilter, searchFilter, pageNumber }) {\n    this.store.dispatch({\n      type: this.actionTypes.updateFilter,\n      sourceFilter,\n      searchFilter,\n      pageNumber,\n    });\n  }\n\n  /**\n   * @function\n   * @param {Object} source - source module object\n   * @param {String} params.sourceName - source name\n   * @param {Bool} params.ready - source module ready status\n   * @param {Bool} params.sourceReady - source ready status\n   * @param {Array} params.contacts - source contacts data\n   * @param {Function} params.getPresence - get source presence function, optional\n   * @param {Function} params.getProfileImage - get source profile image function, optional\n   * @param {Function} params.sync - sync source data function, optional\n   * @param {Function} params.matchPhoneNumber - get match phoneNumber function, optional\n   */\n  addSource(source) {\n    if (!source.sourceName) {\n      throw new Error('Contacts: \"sourceName\" is required in Contacts source.');\n    }\n    if (this._contactSources.has(source.sourceName)) {\n      throw new Error(`Contacts: A contact source named \"${source.sourceName}\" already exists`);\n    }\n    if (source.getPresence && typeof source.getPresence !== 'function') {\n      throw new Error('Contacts: source\\' getPresence must be a function');\n    }\n    if (source.getProfileImage && typeof source.getProfileImage !== 'function') {\n      throw new Error('Contacts: source\\' getProfileImage must be a function');\n    }\n    if (source.matchPhoneNumber && typeof source.matchPhoneNumber !== 'function') {\n      throw new Error('Contacts: source\\' matchPhoneNumber must be a function');\n    }\n    this._contactSources.set(source.sourceName, source);\n    this._sourcesLastStatus.set(source.sourceName, {});\n    this._sourcesUpdatedAt = Date.now();\n  }\n\n  _checkSourceUpdated() {\n    let updated = false;\n    for (const sourceName of Array.from(this._contactSources.keys())) {\n      const source = this._contactSources.get(sourceName);\n      const lastStatus = this._sourcesLastStatus.get(sourceName);\n      if (\n        lastStatus.ready !== source.sourceReady ||\n        lastStatus.data !== source.contacts\n      ) {\n        updated = true;\n        this._sourcesLastStatus.set(sourceName, {\n          ready: source.sourceReady,\n          data: source.contacts,\n        });\n      }\n    }\n    if (updated) {\n      this._sourcesUpdatedAt = Date.now();\n    }\n    return this._sourcesUpdatedAt;\n  }\n\n  matchPhoneNumber(phoneNumber) {\n    let result = [];\n    for (const sourceName of Array.from(this._contactSources.keys())) {\n      const source = this._contactSources.get(sourceName);\n      if (typeof source.matchPhoneNumber === 'function') {\n        result = result.concat(source.matchPhoneNumber(phoneNumber));\n      }\n    }\n    return result;\n  }\n\n  matchContacts({ phoneNumbers }) {\n    const result = {};\n    phoneNumbers.forEach((phoneNumber) => {\n      result[phoneNumber] = this.matchPhoneNumber(phoneNumber);\n    });\n    return result;\n  }\n\n  find({ type, id }) {\n    const contactId = (id || '').toString();\n    const source = this._contactSources.get(type);\n    if (source) {\n      return source.contacts.find(x => x.id.toString() === contactId);\n    }\n    return null;\n  }\n\n  @proxify\n  async getProfileImage(contact, useCache = true) {\n    const source = this._contactSources.get(contact && contact.type);\n    if (source && source.getProfileImage) {\n      const result = await source.getProfileImage(contact, useCache);\n      return result;\n    }\n    return null;\n  }\n\n  @proxify\n  async getPresence(contact, useCache = true) {\n    const source = this._contactSources.get(contact && contact.type);\n    if (source && source.getPresence) {\n      const result = await source.getPresence(contact, useCache);\n      return result;\n    }\n    return null;\n  }\n\n  @proxify\n  async sync() {\n    for (const sourceName of Array.from(this._contactSources.keys())) {\n      const source = this._contactSources.get(sourceName);\n      if (typeof source.sync === 'function') {\n        await source.sync();\n      }\n    }\n  }\n\n  get status() {\n    return this.state.status;\n  }\n\n  get sourceModuleReady() {\n    let ready = true;\n    for (const sourceName of Array.from(this._contactSources.keys())) {\n      const source = this._contactSources.get(sourceName);\n      if (!source.ready) {\n        ready = false;\n      }\n    }\n    return ready;\n  }\n\n  get companyContacts() {\n    const source = this._contactSources.get('company');\n    if (source) {\n      return source.contacts;\n    }\n    return [];\n  }\n\n  get personalContacts() {\n    const source = this._contactSources.get('personal');\n    if (source) {\n      return source.contacts;\n    }\n    return [];\n  }\n\n  get searchFilter() {\n    return this.state.searchFilter;\n  }\n\n  get sourceFilter() {\n    return this.state.sourceFilter;\n  }\n\n  get pageNumber() {\n    return this.state.pageNumber;\n  }\n\n  get allContacts() {\n    return this._selectors.allContacts();\n  }\n\n  get filteredContacts() {\n    return this._selectors.filteredContacts();\n  }\n\n  get sourceNames() {\n    return this._selectors.sourceNames();\n  }\n\n  get contactGroups() {\n    return this._selectors.contactGroups();\n  }\n}\n"]}