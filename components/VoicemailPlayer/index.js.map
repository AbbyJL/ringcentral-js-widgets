{"version":3,"sources":["components/VoicemailPlayer/index.js"],"names":["audiosMap","VoicemailPlayer","props","state","playing","paused","progress","_id","uri","split","pop","Date","getTime","_audio","Audio","volume","addEventListener","_mounted","setState","currentTime","duration","isPlaying","_playAudio","src","load","_pauseOtherAudios","play","onPlay","_pauseAudio","pause","forEach","id","otherAudio","className","disabled","icon","root","startTime","download","endTime","all","done","width","current","left","propTypes","number","string","isRequired","func","bool","defaultProps","undefined"],"mappings":"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","file":"index.js","sourcesContent":["import React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport classnames from 'classnames';\n\nimport formatDuration from '../../lib/formatDuration';\nimport DownloadIcon from '../../assets/images/Download.svg';\nimport PlayIcon from '../../assets/images/Play.svg';\nimport PauseIcon from '../../assets/images/Pause.svg';\n\nimport Button from '../Button';\n\nimport styles from './styles.scss';\n\nconst audiosMap = {};\n\nclass VoicemailPlayer extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      playing: false,\n      paused: false,\n      progress: 0,\n    };\n\n    this._id = `${props.uri && props.uri.split('?')[0].split('/').pop()}/${(new Date()).getTime()}`;\n    this._audio = new Audio();\n    this._audio.volume = 1;\n    audiosMap[this._id] = this._audio;\n    this._audio.addEventListener('timeupdate', () => {\n      if (!this._mounted) {\n        return;\n      }\n      this.setState({\n        progress: (this._audio.currentTime / this._audio.duration),\n      });\n    });\n\n    this._audio.addEventListener('ended', () => {\n      if (!this._mounted) {\n        return;\n      }\n      this.setState({\n        playing: false,\n      });\n      this._audio.isPlaying = false;\n    });\n\n    this._audio.addEventListener('pause', () => {\n      if (!this._mounted) {\n        return;\n      }\n      this.setState({\n        paused: true,\n        playing: false,\n      });\n      this._audio.isPlaying = false;\n    });\n\n    this._audio.addEventListener('play', () => {\n      if (!this._mounted) {\n        return;\n      }\n      this.setState({\n        playing: true,\n        paused: false,\n      });\n      this._audio.isPlaying = true;\n    });\n\n    this._playAudio = () => {\n      if (this.state.playing) {\n        return;\n      }\n      if (!this.state.paused) {\n        this._audio.src = props.uri;\n        this._audio.load(props.uri);\n        this._audio.currentTime = 0;\n      }\n      this._pauseOtherAudios();\n      this._audio.play();\n      if (typeof this.props.onPlay === 'function') {\n        this.props.onPlay();\n      }\n    };\n\n    this._pauseAudio = () => {\n      if (this.state.paused) {\n        return;\n      }\n      this._audio.pause();\n    };\n  }\n\n  _pauseOtherAudios() {\n    Object.keys(audiosMap).forEach((id) => {\n      if (id === this._id) {\n        return;\n      }\n      const otherAudio = audiosMap[id];\n      if (otherAudio.isPlaying) {\n        otherAudio.pause();\n      }\n    });\n  }\n  componentDidMount() {\n    this._mounted = true;\n  }\n\n  componentWillUnmount() {\n    this._mounted = false;\n    this._audio.currentTime = 0;\n    this._audio.pause();\n    delete audiosMap[this._id];\n  }\n\n  render() {\n    const {\n      className,\n      duration,\n      uri,\n      disabled,\n    } = this.props;\n    let icon;\n    if (this.state.playing) {\n      icon = (\n        <Button\n          className={classnames(styles.play, (disabled ? styles.disabled : null))}\n          onClick={this._pauseAudio}\n          disabled={disabled}\n        >\n          <PauseIcon width={18} height={18} />\n        </Button>\n      );\n    } else {\n      icon = (\n        <Button\n          className={classnames(styles.play, (disabled ? styles.disabled : null))}\n          onClick={this._playAudio}\n          disabled={disabled}\n        >\n          <PlayIcon width={18} height={18} />\n        </Button>\n      );\n    }\n    return (\n      <div className={classnames(styles.root, className)}>\n        {icon}\n        <span className={styles.startTime}>{formatDuration(this._audio.currentTime)}</span>\n        <a\n          className={classnames(styles.download, (disabled ? styles.disabled : null))}\n          target=\"_blank\"\n          download\n          href={uri}\n        >\n          <DownloadIcon width={18} height={18} />\n        </a>\n        <span className={styles.endTime}>{formatDuration(duration)}</span>\n        <div className={styles.progress}>\n          <div className={styles.all} />\n          <div className={styles.done} style={{ width: `${this.state.progress * 100}%` }} />\n          <div className={styles.current} style={{ left: `${this.state.progress * 100}%` }} />\n        </div>\n      </div>\n    );\n  }\n}\n\nVoicemailPlayer.propTypes = {\n  duration: PropTypes.number,\n  uri: PropTypes.string.isRequired,\n  className: PropTypes.string,\n  onPlay: PropTypes.func,\n  disabled: PropTypes.bool,\n};\n\nVoicemailPlayer.defaultProps = {\n  duration: 0,\n  className: undefined,\n  onPlay: undefined,\n  disabled: false,\n};\n\nexport default VoicemailPlayer;\n"]}