{"version":3,"sources":["components/VoicemailPlayer/index.js"],"names":["audiosMap","VoicemailPlayer","props","state","playing","paused","progress","_id","uri","split","pop","Date","getTime","_audio","Audio","volume","addEventListener","_mounted","setState","currentTime","duration","isPlaying","_playAudio","src","load","_pauseOtherAudios","play","onPlay","_pauseAudio","pause","_onDownloadClick","e","disabled","preventDefault","forEach","id","otherAudio","className","currentLocale","icon","getString","root","startTime","download","endTime","all","done","width","current","left","propTypes","number","string","isRequired","func","bool","defaultProps","undefined"],"mappings":"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","file":"index.js","sourcesContent":["import React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport classnames from 'classnames';\n\nimport formatDuration from '../../lib/formatDuration';\nimport DownloadIcon from '../../assets/images/Download.svg';\nimport PlayIcon from '../../assets/images/Play.svg';\nimport PauseIcon from '../../assets/images/Pause.svg';\n\nimport Button from '../Button';\n\nimport styles from './styles.scss';\nimport i18n from './i18n';\n\nconst audiosMap = {};\n\nclass VoicemailPlayer extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      playing: false,\n      paused: false,\n      progress: 0,\n    };\n\n    this._id = `${props.uri && props.uri.split('?')[0].split('/').pop()}/${(new Date()).getTime()}`;\n    this._audio = new Audio();\n    this._audio.volume = 1;\n    audiosMap[this._id] = this._audio;\n    this._audio.addEventListener('timeupdate', () => {\n      if (!this._mounted) {\n        return;\n      }\n      this.setState({\n        progress: (this._audio.currentTime / this._audio.duration),\n      });\n    });\n\n    this._audio.addEventListener('ended', () => {\n      if (!this._mounted) {\n        return;\n      }\n      this.setState({\n        playing: false,\n      });\n      this._audio.isPlaying = false;\n    });\n\n    this._audio.addEventListener('pause', () => {\n      if (!this._mounted) {\n        return;\n      }\n      this.setState({\n        paused: true,\n        playing: false,\n      });\n      this._audio.isPlaying = false;\n    });\n\n    this._audio.addEventListener('play', () => {\n      if (!this._mounted) {\n        return;\n      }\n      this.setState({\n        playing: true,\n        paused: false,\n      });\n      this._audio.isPlaying = true;\n    });\n\n    this._playAudio = () => {\n      if (this.state.playing) {\n        return;\n      }\n      if (!this.state.paused) {\n        this._audio.src = this.props.uri;\n        this._audio.load(this.props.uri);\n        this._audio.currentTime = 0;\n      }\n      this._pauseOtherAudios();\n      this._audio.play();\n      if (typeof this.props.onPlay === 'function') {\n        this.props.onPlay();\n      }\n    };\n\n    this._pauseAudio = () => {\n      if (this.state.paused) {\n        return;\n      }\n      this._audio.pause();\n    };\n\n    this._onDownloadClick = (e) => {\n      if (this.props.disabled) {\n        e.preventDefault();\n      }\n    };\n  }\n\n  _pauseOtherAudios() {\n    Object.keys(audiosMap).forEach((id) => {\n      if (id === this._id) {\n        return;\n      }\n      const otherAudio = audiosMap[id];\n      if (otherAudio.isPlaying) {\n        otherAudio.pause();\n      }\n    });\n  }\n\n  componentDidMount() {\n    this._mounted = true;\n  }\n\n  componentWillUnmount() {\n    this._mounted = false;\n    this._audio.currentTime = 0;\n    this._audio.pause();\n    delete audiosMap[this._id];\n  }\n\n  render() {\n    const {\n      className,\n      duration,\n      uri,\n      disabled,\n      currentLocale,\n    } = this.props;\n    let icon;\n    if (this.state.playing) {\n      icon = (\n        <Button\n          className={classnames(styles.play, (disabled ? styles.disabled : null))}\n          onClick={this._pauseAudio}\n          disabled={disabled}\n        >\n          <span title={i18n.getString('pause', currentLocale)}>\n            <PauseIcon width={18} height={18} />\n          </span>\n        </Button>\n      );\n    } else {\n      icon = (\n        <Button\n          className={classnames(styles.play, (disabled ? styles.disabled : null))}\n          onClick={this._playAudio}\n          disabled={disabled}\n        >\n          <span title={i18n.getString('play', currentLocale)}>\n            <PlayIcon width={18} height={18} />\n          </span>\n        </Button>\n      );\n    }\n    const currentTime =\n      (this._audio.currentTime < duration) ? this._audio.currentTime : duration;\n    return (\n      <div className={classnames(styles.root, className)}>\n        {icon}\n        <span className={styles.startTime}>{formatDuration(currentTime)}</span>\n        <a\n          className={classnames(styles.download, (disabled ? styles.disabled : null))}\n          target=\"_blank\"\n          download\n          title={i18n.getString('download', currentLocale)}\n          href={uri}\n          onClick={this._onDownloadClick}\n        >\n          <DownloadIcon width={18} height={18} />\n        </a>\n        <span className={styles.endTime}>{formatDuration(duration)}</span>\n        <div className={styles.progress}>\n          <div className={styles.all} />\n          <div className={styles.done} style={{ width: `${this.state.progress * 100}%` }} />\n          <div className={styles.current} style={{ left: `${this.state.progress * 100}%` }} />\n        </div>\n      </div>\n    );\n  }\n}\n\nVoicemailPlayer.propTypes = {\n  duration: PropTypes.number,\n  uri: PropTypes.string.isRequired,\n  className: PropTypes.string,\n  onPlay: PropTypes.func,\n  disabled: PropTypes.bool,\n  currentLocale: PropTypes.string.isRequired,\n};\n\nVoicemailPlayer.defaultProps = {\n  duration: 0,\n  className: undefined,\n  onPlay: undefined,\n  disabled: false,\n};\n\nexport default VoicemailPlayer;\n"]}