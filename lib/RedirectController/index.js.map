{"version":3,"sources":["lib/RedirectController/index.js"],"names":["RedirectController","prefix","window","addEventListener","callbackUri","location","href","opener","oAuthCallback","close","e","parse","state","query","uuid","split","slice","join","key","localStorage","removeItem","newValue","setItem"],"mappings":";;;;;;;;;;;AAAA;;;;;;IAEqBA,kB,GACnB,8BAEQ;AAAA,iFAAJ,EAAI;AAAA,MADNC,MACM,QADNA,MACM;;AAAA;;AACNC,SAAOC,gBAAP,CAAwB,MAAxB,EAAgC,YAAM;AACpC,QAAMC,cAAcF,OAAOG,QAAP,CAAgBC,IAApC;AACA;AACA;AACA,QAAI;AACF,UAAIJ,OAAOK,MAAP,IAAiBL,OAAOK,MAAP,CAAcC,aAAnC,EAAkD;AAChDN,eAAOK,MAAP,CAAcC,aAAd,CAA4BJ,WAA5B;AACAF,eAAOO,KAAP;AACA;AACD;AACF,KAND,CAME,OAAOC,CAAP,EAAU,CAEX;AADC;;AAEF;;AAboC,qBAmBhC,cAAIC,KAAJ,CAAUP,WAAV,EAAuB,IAAvB,CAnBgC;AAAA,QAiBhCQ,KAjBgC,cAgBlCC,KAhBkC,CAiBhCD,KAjBgC;;AAoBpC,QAAME,OAAOF,MAAMG,KAAN,CAAY,GAAZ,EAAiBC,KAAjB,CAAuB,CAAvB,EAA0BC,IAA1B,CAA+B,GAA/B,CAAb;AACA,QAAMC,MAASjB,MAAT,SAAmBa,IAAnB,0BAAN;AACAK,iBAAaC,UAAb,CAAwBF,GAAxB;AACAhB,WAAOC,gBAAP,CAAwB,SAAxB,EAAmC,UAACO,CAAD,EAAO;AACxC,UAAIA,EAAEQ,GAAF,KAAUA,GAAV,KAAkB,CAACR,EAAEW,QAAH,IAAeX,EAAEW,QAAF,KAAe,EAAhD,CAAJ,EAAyD;AACvDnB,eAAOO,KAAP;AACD;AACF,KAJD;AAKAU,iBAAaG,OAAb,CAAqBJ,GAArB,EAA0Bd,WAA1B;AACD,GA7BD;AA8BD,C;;kBAlCkBJ,kB","file":"index.js","sourcesContent":["import url from 'url';\r\n\r\nexport default class RedirectController {\r\n  constructor({\r\n    prefix,\r\n  } = {}) {\r\n    window.addEventListener('load', () => {\r\n      const callbackUri = window.location.href;\r\n      // RCINT-3477 some devices will have reference to opener, but will throw exception\r\n      // when tring to access opener\r\n      try {\r\n        if (window.opener && window.opener.oAuthCallback) {\r\n          window.opener.oAuthCallback(callbackUri);\r\n          window.close();\r\n          return;\r\n        }\r\n      } catch (e) {\r\n        /* ignore error */\r\n      }\r\n      // fall back to use localStorage as a vessel to avoid opener is null bug\r\n\r\n      const {\r\n        query: {\r\n          state,\r\n        },\r\n      } = url.parse(callbackUri, true);\r\n      const uuid = state.split('-').slice(1).join('-');\r\n      const key = `${prefix}-${uuid}-redirect-callbackUri`;\r\n      localStorage.removeItem(key);\r\n      window.addEventListener('storage', (e) => {\r\n        if (e.key === key && (!e.newValue || e.newValue === '')) {\r\n          window.close();\r\n        }\r\n      });\r\n      localStorage.setItem(key, callbackUri);\r\n    });\r\n  }\r\n}\r\n"]}