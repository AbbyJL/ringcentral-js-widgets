{"version":3,"sources":["lib/readXlfData/index.js"],"names":["readXlfData","extractKey","str","substring","length","extractXlfData","locale","content","data","xml","xml2js","compact","xliff","file","files","Array","isArray","output","fileData","_attributes","body","fileName","original","units","fileOutput","unit","id","target","_text","value","source","localizationFolder","supportedLocales","filePath","path","resolve","fs","existsSync","statSync","isFile","readFileSync"],"mappings":";;;;;kBA4DwBA,W;;AA5DxB;;;;AACA;;;;AACA;;;;AACA;;;;AAEA,SAASC,UAAT,CAAoBC,GAApB,EAAyB;AACvB,SAAOA,IAAIC,SAAJ,CAAc,CAAd,EAAiBD,IAAIE,MAAJ,GAAa,CAA9B,CAAP;AACD;;AAED,SAASC,cAAT,OAA6C;AAAA,MAAnBC,MAAmB,QAAnBA,MAAmB;AAAA,MAAXC,OAAW,QAAXA,OAAW;;AAC3C,MAAMC,OAAOC,gBAAIC,MAAJ,CAAWH,OAAX,EAAoB,EAAEI,SAAS,IAAX,EAApB,CAAb;AACA,MACEH,KAAKI,KAAL,IACAJ,KAAKI,KAAL,CAAWC,IAFb,EAGE;AACA,QAAMC,QAAQC,MAAMC,OAAN,CAAcR,KAAKI,KAAL,CAAWC,IAAzB,IACZL,KAAKI,KAAL,CAAWC,IADC,GAEZ,CAACL,KAAKI,KAAL,CAAWC,IAAZ,CAFF;AAGA,WAAO,mBACL,UAACI,MAAD,EAASC,QAAT,EAAsB;AACpB,UACEA,SAASC,WAAT,IACAD,SAASC,WAAT,CAAqB,iBAArB,MAA4Cb,MAD5C,IAEAY,SAASE,IAFT,IAGAF,SAASE,IAAT,CAAc,YAAd,CAJF,EAKE;AACA,YAAMC,WAAWH,SAASC,WAAT,CAAqBG,QAAtC;;AAEA,YAAMC,QAAQR,MAAMC,OAAN,CAAcE,SAASE,IAAT,CAAc,YAAd,CAAd,IACZF,SAASE,IAAT,CAAc,YAAd,CADY,GAEZ,CAACF,SAASE,IAAT,CAAc,YAAd,CAAD,CAFF;AAGAH,eAAOI,QAAP,IAAmB,mBACjB,UAACG,UAAD,EAAaC,IAAb,EAAsB;AACpB,cACEA,KAAKN,WAAL,IACAM,KAAKN,WAAL,CAAiBO,EADjB,IAEAD,KAAKE,MAFL,IAGAF,KAAKE,MAAL,CAAYC,KAJd,EAKE;AACAJ,uBAAWvB,WAAWwB,KAAKN,WAAL,CAAiBO,EAA5B,CAAX,IAA8C;AAC5CG,qBAAOJ,KAAKE,MAAL,CAAYC,KADyB;AAE5CE,sBAAQL,KAAKK,MAAL,CAAYF;AAFwB,aAA9C;AAID;AACD,iBAAOJ,UAAP;AACD,SAdgB,EAejB,EAfiB,EAgBjBD,KAhBiB,CAAnB;AAkBD;AACD,aAAON,MAAP;AACD,KAjCI,EAkCL,EAlCK,EAmCLH,KAnCK,CAAP;AAqCD;AACD,SAAO,EAAP;AACD;;AAGc,SAASd,WAAT,QAGZ;AAAA,MAFD+B,kBAEC,SAFDA,kBAEC;AAAA,MADDC,gBACC,SADDA,gBACC;;AACD,SAAO,mBACL,UAACxB,IAAD,EAAOF,MAAP,EAAkB;AAChB,QAAMe,WAAcf,MAAd,SAAN;AACA,QAAM2B,WAAWC,eAAKC,OAAL,CAAaJ,kBAAb,EAAiCV,QAAjC,CAAjB;AACA,QAAKe,kBAAGC,UAAH,CAAcJ,QAAd,CAAD,IAA8BG,kBAAGE,QAAH,CAAYL,QAAZ,CAAD,CAAwBM,MAAxB,EAAjC,EAAmE;AACjE,UAAMhC,UAAU6B,kBAAGI,YAAH,CAAgBP,QAAhB,EAA0B,MAA1B,CAAhB;AACAzB,WAAKF,MAAL,IAAeD,eAAe,EAAEC,cAAF,EAAUC,gBAAV,EAAf,CAAf;AACD;AACD,WAAOC,IAAP;AACD,GATI,EAUL,EAVK,EAWLwB,gBAXK,CAAP;AAaD","file":"index.js","sourcesContent":["import xml from 'xml-js';\nimport fs from 'fs-extra';\nimport path from 'path';\nimport { reduce } from 'ramda';\n\nfunction extractKey(str) {\n  return str.substring(1, str.length - 1);\n}\n\nfunction extractXlfData({ locale, content }) {\n  const data = xml.xml2js(content, { compact: true });\n  if (\n    data.xliff &&\n    data.xliff.file\n  ) {\n    const files = Array.isArray(data.xliff.file) ?\n      data.xliff.file :\n      [data.xliff.file];\n    return reduce(\n      (output, fileData) => {\n        if (\n          fileData._attributes &&\n          fileData._attributes['target-language'] === locale &&\n          fileData.body &&\n          fileData.body['trans-unit']\n        ) {\n          const fileName = fileData._attributes.original;\n\n          const units = Array.isArray(fileData.body['trans-unit']) ?\n            fileData.body['trans-unit'] :\n            [fileData.body['trans-unit']];\n          output[fileName] = reduce(\n            (fileOutput, unit) => {\n              if (\n                unit._attributes &&\n                unit._attributes.id &&\n                unit.target &&\n                unit.target._text\n              ) {\n                fileOutput[extractKey(unit._attributes.id)] = {\n                  value: unit.target._text,\n                  source: unit.source._text,\n                };\n              }\n              return fileOutput;\n            },\n            {},\n            units,\n          );\n        }\n        return output;\n      },\n      {},\n      files,\n    );\n  }\n  return {};\n}\n\n\nexport default function readXlfData({\n  localizationFolder,\n  supportedLocales,\n}) {\n  return reduce(\n    (data, locale) => {\n      const fileName = `${locale}.xlf`;\n      const filePath = path.resolve(localizationFolder, fileName);\n      if ((fs.existsSync(filePath)) && (fs.statSync(filePath)).isFile()) {\n        const content = fs.readFileSync(filePath, 'utf8');\n        data[locale] = extractXlfData({ locale, content });\n      }\n      return data;\n    },\n    {},\n    supportedLocales\n  );\n}\n"]}