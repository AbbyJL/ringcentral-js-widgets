{"version":3,"sources":["lib/AdapterCore/index.js"],"names":["AdapterCore","prefix","styles","container","root","messageTransport","messageTypes","defaultDirection","defaultPadding","_onWindowResize","_dragging","_resizeTimeout","clearTimeout","setTimeout","_renderRestrictedPosition","_resizeTick","Date","now","_onWindowMouseMove","e","buttons","_renderMainClass","factor","_calculateFactor","delta","x","clientX","_dragStartPosition","y","clientY","_minimized","_minTranslateX","minTranslateX","_translateX","translateX","_translateY","translateY","_syncPosition","_debouncedPostMessage","_postMessage","_prefix","_messageTypes","enumMap","_messageTransport","_container","_root","_styles","_defaultDirection","_padding","_appWidth","_appHeight","_closed","_hover","_loading","_userStatus","_dndStatus","addListener","msg","type","syncClosed","_onSyncClosed","closed","syncMinimized","_onSyncMinimized","minimized","syncSize","_onSyncSize","size","syncPresence","_onSyncPresence","syncAdapterState","_onSyncAdapterState","innerHTML","header","presence","NoPresence","presenceBar","button","toggle","minimizeIcon","minimizeIconBar","close","closeIcon","logo","frameContainer","contentFrame","_headerEl","querySelector","_logoEl","addEventListener","_contentFrameContainerEl","_toggleEl","toggleMinimized","_closeEl","setClosed","_presenceEl","presenceClicked","_contentFrameEl","window","document","readyState","body","appendChild","_render","data","postMessage","logoUrl","_logoUrl","src","setAttribute","visible","appUrl","_appUrl","contentFrameEl","renderAdapterSize","setMinimized","maximumX","innerWidth","clientWidth","maximumY","innerHeight","clientHeight","minimumX","minimumY","width","height","style","dndStatus","userStatus","renderPresence","call","syncPosition","position","_calculateMinMaxPosition","newMinTranslateX","Math","max","min","newTranslateX","newTranslateY","renderPosition","dragging","hover","loading","_ringing","ringing","removeEventListener","remove"],"mappings":"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","file":"index.js","sourcesContent":["import { prefixEnum } from 'ringcentral-integration/lib/Enum';\r\nimport ensureExist from 'ringcentral-integration/lib/ensureExist';\r\nimport debounce from 'ringcentral-integration/lib/debounce';\r\nimport classnames from 'classnames';\r\nimport baseMessageTypes from './baseMessageTypes';\r\n\r\nexport default class AdapterCore {\r\n  constructor({\r\n    prefix,\r\n    styles,\r\n    container,\r\n    root = container,\r\n    messageTransport,\r\n    messageTypes = baseMessageTypes,\r\n    defaultDirection = 'left',\r\n    defaultPadding = 15,\r\n  }) {\r\n    this._prefix = prefix;\r\n    this._messageTypes = prefixEnum({ enumMap: messageTypes, prefix });\r\n    this._messageTransport = this::ensureExist(messageTransport, 'messageTransport');\r\n    this._container = this::ensureExist(container, 'container');\r\n    this._root = root;\r\n    this._styles = styles;\r\n    this._defaultDirection = defaultDirection;\r\n\r\n    this._padding = defaultPadding;\r\n    this._minTranslateX = 0;\r\n    this._translateX = 0;\r\n    this._translateY = 0;\r\n    this._appWidth = 0;\r\n    this._appHeight = 0;\r\n    this._dragStartPosition = null;\r\n\r\n    this._closed = true;\r\n    this._minimized = true;\r\n    this._dragging = false;\r\n    this._hover = false;\r\n    this._loading = false;\r\n    this._userStatus = null;\r\n    this._dndStatus = null;\r\n\r\n    this._messageTransport.addListener((msg) => {\r\n      if (msg) {\r\n        switch (msg.type) {\r\n          case this._messageTypes.syncClosed:\r\n            this._onSyncClosed(msg.closed);\r\n            break;\r\n          case this._messageTypes.syncMinimized:\r\n            this._onSyncMinimized(msg.minimized);\r\n            break;\r\n          case this._messageTypes.syncSize:\r\n            this._onSyncSize(msg.size);\r\n            break;\r\n          case this._messageTypes.syncPresence:\r\n            this._onSyncPresence(msg);\r\n            break;\r\n          case this._messageTypes.syncAdapterState:\r\n            this._onSyncAdapterState(msg);\r\n            break;\r\n          default:\r\n            break;\r\n        }\r\n      }\r\n    });\r\n  }\r\n  _generateContentDOM() {\r\n    this._root.innerHTML = `\r\n      <header class=\"${this._styles.header}\" draggable=\"false\">\r\n        <div class=\"${this._styles.presence} ${this._styles.NoPresence}\">\r\n          <div class=\"${this._styles.presenceBar}\">\r\n          </div>\r\n        </div>\r\n        <div class=\"${this._styles.button} ${this._styles.toggle}\">\r\n          <div class=\"${this._styles.minimizeIcon}\">\r\n            <div class=\"${this._styles.minimizeIconBar}\"></div>\r\n          </div>\r\n        </div>\r\n        <div class=\"${this._styles.button} ${this._styles.close}\">\r\n          <div class=\"${this._styles.closeIcon}\">\r\n            <div></div><div></div>\r\n          </div>\r\n        </div>\r\n        <img class=\"${this._styles.logo}\" draggable=\"false\"></img>\r\n      </header>\r\n      <div class=\"${this._styles.frameContainer}\">\r\n        <iframe class=\"${this._styles.contentFrame}\" sandbox=\"allow-same-origin allow-scripts allow-forms\">\r\n        </iframe>\r\n      </div>\r\n    `;\r\n    this._headerEl = this._root.querySelector(\r\n      `.${this._styles.header}`\r\n    );\r\n    this._logoEl = this._root.querySelector(\r\n      `.${this._styles.logo}`\r\n    );\r\n    this._logoEl.addEventListener('dragstart', () => false);\r\n\r\n    this._contentFrameContainerEl = this._root.querySelector(\r\n      `.${this._styles.frameContainer}`\r\n    );\r\n\r\n    // toggle button\r\n    this._toggleEl = this._root.querySelector(\r\n      `.${this._styles.toggle}`\r\n    );\r\n    this._toggleEl.addEventListener('click', () => {\r\n      this.toggleMinimized();\r\n    });\r\n\r\n    // close button\r\n    this._closeEl = this._root.querySelector(\r\n      `.${this._styles.close}`\r\n    );\r\n    this._closeEl.addEventListener('click', () => {\r\n      this.setClosed(true);\r\n    });\r\n\r\n    this._presenceEl = this._root.querySelector(\r\n      `.${this._styles.presence}`\r\n    );\r\n    this._presenceEl.addEventListener('click', () => {\r\n      this._postMessage({\r\n        type: this._messageTypes.presenceClicked,\r\n      });\r\n    });\r\n    this._contentFrameEl = this._root.querySelector(\r\n      `.${this._styles.contentFrame}`\r\n    );\r\n\r\n    this._headerEl.addEventListener('mousedown', (e) => {\r\n      this._dragging = true;\r\n      this._dragStartPosition = {\r\n        x: e.clientX,\r\n        y: e.clientY,\r\n        translateX: this._translateX,\r\n        translateY: this._translateY,\r\n        minTranslateX: this._minTranslateX,\r\n      };\r\n      this._renderMainClass();\r\n    });\r\n    this._headerEl.addEventListener('mouseup', () => {\r\n      this._dragging = false;\r\n      this._renderMainClass();\r\n    });\r\n    window.addEventListener('mousemove', this._onWindowMouseMove);\r\n\r\n    this._resizeTimeout = null;\r\n    this._resizeTick = null;\r\n    window.addEventListener('resize', this._onWindowResize);\r\n\r\n    // hover detection for ie\r\n    this._container.addEventListener('mouseenter', () => {\r\n      this._hover = true;\r\n      this._renderMainClass();\r\n    });\r\n    this._container.addEventListener('mouseleave', () => {\r\n      this._hover = false;\r\n      this._renderMainClass();\r\n    });\r\n    if (document.readyState === 'loading') {\r\n      window.addEventListener('load', () => {\r\n        document.body.appendChild(this._container);\r\n      });\r\n    } else {\r\n      document.body.appendChild(this._container);\r\n    }\r\n\r\n    this._render();\r\n  }\r\n  _onWindowResize = () => {\r\n    if (this._dragging) { return; }\r\n    if (this._resizeTimeout) { clearTimeout(this._resizeTimeout); }\r\n    this._resizeTimeout = setTimeout(() => this._renderRestrictedPosition(), 100);\r\n    if (!this._resizeTick || Date.now() - this._resizeTick > 50) {\r\n      this._resizeTick = Date.now();\r\n      this._renderRestrictedPosition();\r\n    }\r\n  }\r\n  _onWindowMouseMove = (e) => {\r\n    if (this._dragging) {\r\n      if (e.buttons === 0) {\r\n        this._dragging = false;\r\n        this._renderMainClass();\r\n        return;\r\n      }\r\n      const factor = this._calculateFactor();\r\n      const delta = {\r\n        x: e.clientX - this._dragStartPosition.x,\r\n        y: e.clientY - this._dragStartPosition.y,\r\n      };\r\n      if (this._minimized) {\r\n        this._minTranslateX = this._dragStartPosition.minTranslateX + delta.x * factor;\r\n      } else {\r\n        this._translateX = this._dragStartPosition.translateX + delta.x * factor;\r\n        this._translateY = this._dragStartPosition.translateY + delta.y;\r\n      }\r\n      this._syncPosition();\r\n      this._renderRestrictedPosition();\r\n    }\r\n  }\r\n  _postMessage(data) {\r\n    this._messageTransport.postMessage(data);\r\n  }\r\n\r\n  _setLogoUrl(logoUrl) {\r\n    this._logoUrl = logoUrl;\r\n    this._logoEl.src = logoUrl;\r\n    this._logoEl.setAttribute('class', classnames(\r\n      this._styles.logo,\r\n      this._logoUrl && this._logoUrl !== '' && this._styles.visible,\r\n    ));\r\n  }\r\n\r\n  _setAppUrl(appUrl) {\r\n    this._appUrl = appUrl;\r\n    if (appUrl) {\r\n      this.contentFrameEl.src = appUrl;\r\n    }\r\n  }\r\n\r\n  _onSyncMinimized(minimized) {\r\n    this._minimized = !!minimized;\r\n    this._renderMainClass();\r\n    this.renderAdapterSize();\r\n    this._renderRestrictedPosition();\r\n  }\r\n  setMinimized(minimized) {\r\n    this._onSyncMinimized(minimized);\r\n    this._postMessage({\r\n      type: this._messageTypes.syncMinimized,\r\n      minimized: this._minimized,\r\n    });\r\n  }\r\n  toggleMinimized() {\r\n    this.setMinimized(!this._minimized);\r\n  }\r\n\r\n  _calculateMinMaxPosition() {\r\n    const maximumX = window.innerWidth -\r\n      (this._minimized ? this._headerEl.clientWidth : this._appWidth) - 2 * this._padding;\r\n    const maximumY = window.innerHeight -\r\n      (this._minimized ?\r\n        this._headerEl.clientHeight :\r\n        this._headerEl.clientHeight + this._appHeight) - this._padding;\r\n    return {\r\n      minimumX: this._padding,\r\n      minimumY: this._padding,\r\n      maximumX,\r\n      maximumY,\r\n    };\r\n  }\r\n\r\n  _onSyncClosed(closed) {\r\n    this._closed = !!closed;\r\n    this._renderMainClass();\r\n  }\r\n  setClosed(closed) {\r\n    this._onSyncClosed(closed);\r\n    this._postMessage({\r\n      type: this._messageTypes.syncClosed,\r\n      closed: this.closed,\r\n    });\r\n  }\r\n  toggleClosed() {\r\n    this.setClosed(!this.closed);\r\n  }\r\n\r\n  _onSyncSize({ width, height }) {\r\n    this._appWidth = width;\r\n    this._appHeight = height;\r\n    this._contentFrameEl.style.width = `${width}px`;\r\n    this._contentFrameEl.style.height = `${height}px`;\r\n    this.renderAdapterSize();\r\n  }\r\n  setSize(size) {\r\n    this._onSyncSize(size);\r\n    this._postMessage({\r\n      type: this._messageTypes.syncSize,\r\n      size,\r\n    });\r\n  }\r\n  _onSyncPresence({ dndStatus, userStatus }) {\r\n    if (dndStatus !== this._dndStatus || userStatus !== this._userStatus) {\r\n      this._dndStatus = dndStatus;\r\n      this._userStatus = userStatus;\r\n      this.renderPresence();\r\n    }\r\n  }\r\n\r\n  _debouncedPostMessage = debounce(this._postMessage, 200)\r\n\r\n  _syncPosition() {\r\n    this._debouncedPostMessage.call(this, {\r\n      type: this._messageTypes.syncPosition,\r\n      position: {\r\n        translateX: this._translateX,\r\n        translateY: this._translateY,\r\n        minTranslateX: this._minTranslateX,\r\n      },\r\n    });\r\n  }\r\n  _onSyncAdapterState({\r\n    size: { width, height },\r\n    minimized,\r\n    closed,\r\n    position: { translateX, translateY, minTranslateX },\r\n    dndStatus,\r\n    userStatus,\r\n   }) {\r\n    this._minimized = minimized;\r\n    this._closed = closed;\r\n    if (!this._dragging) {\r\n      this._translateX = translateX;\r\n      this._translateY = translateY;\r\n      this._minTranslateX = minTranslateX;\r\n    }\r\n    this._appWidth = width;\r\n    this._appHeight = height;\r\n    this._dndStatus = dndStatus;\r\n    this._userStatus = userStatus;\r\n    this._loading = false;\r\n    this._render();\r\n  }\r\n  _calculateFactor() {\r\n    return this._defaultDirection === 'right' ?\r\n      -1 :\r\n      1;\r\n  }\r\n  renderPosition() {\r\n    const factor = this._calculateFactor();\r\n    if (this._minimized) {\r\n      this._container.setAttribute(\r\n        'style',\r\n        `transform: translate( ${this._minTranslateX * factor}px, ${-this._padding}px)!important;`\r\n      );\r\n    } else {\r\n      this._container.setAttribute(\r\n        'style',\r\n        `transform: translate( ${this._translateX * factor}px, ${this._translateY}px)!important;`\r\n      );\r\n    }\r\n  }\r\n  _renderRestrictedPosition() {\r\n    const {\r\n      minimumX,\r\n      minimumY,\r\n      maximumX,\r\n      maximumY,\r\n    } = this._calculateMinMaxPosition();\r\n\r\n    if (this._minimized) {\r\n      const newMinTranslateX = Math.max(Math.min(this._minTranslateX, maximumX), minimumX);\r\n      if (newMinTranslateX !== this._minTranslateX) {\r\n        this._minTranslateX = newMinTranslateX;\r\n      }\r\n    } else {\r\n      const newTranslateX = Math.max(Math.min(this._translateX, maximumX), minimumX);\r\n      const newTranslateY = Math.max(Math.min(this._translateY, -minimumY), -maximumY);\r\n      if (this._translateX !== newTranslateX || this._translateY !== newTranslateY) {\r\n        this._translateX = newTranslateX;\r\n        this._translateY = newTranslateY;\r\n      }\r\n    }\r\n    this.renderPosition();\r\n  }\r\n  renderAdapterSize() {\r\n    if (this._minimized) {\r\n      this._contentFrameContainerEl.style.width = 0;\r\n      this._contentFrameContainerEl.style.height = 0;\r\n    } else {\r\n      this._contentFrameContainerEl.style.width = `${this._appWidth}px`;\r\n      this._contentFrameContainerEl.style.height = `${this._appHeight}px`;\r\n      this._contentFrameEl.style.width = `${this._appWidth}px`;\r\n      this._contentFrameEl.style.height = `${this._appHeight}px`;\r\n    }\r\n  }\r\n  _renderMainClass() {\r\n    this._container.setAttribute('class', classnames(\r\n      this._styles.root,\r\n      this._styles[this._defaultDirection],\r\n      this._closed && this._styles.closed,\r\n      this._minimized && this._styles.minimized,\r\n      this._dragging && this._styles.dragging,\r\n      this._hover && this._styles.hover,\r\n      this._loading && this._styles.loading,\r\n      this._ringing && this._styles.ringing,\r\n    ));\r\n    this._headerEl.setAttribute('class', classnames(\r\n      this._styles.header,\r\n      this._minimized && this._styles.minimized,\r\n      this._ringing && this._styles.ringing,\r\n    ));\r\n  }\r\n  renderPresence() {\r\n    this._presenceEl.setAttribute('class', classnames(\r\n      this._minimized && this._styles.minimized,\r\n      this._styles.presence,\r\n      this._userStatus && this._styles[this._userStatus],\r\n      this._dndStatus && this._styles[this._dndStatus],\r\n    ));\r\n  }\r\n  _render() {\r\n    this._renderMainClass();\r\n    this.renderPresence();\r\n    this.renderAdapterSize();\r\n    this._renderRestrictedPosition();\r\n  }\r\n\r\n  dispose() {\r\n    // TODO clean up\r\n    window.removeEventListener('mousemove', this._onWindowMouseMove);\r\n    window.removeEventListener('resize', this._onWindowResize);\r\n    if (this._resizeTimeout) {\r\n      clearTimeout(this._resizeTick);\r\n    }\r\n    this._container.remove();\r\n  }\r\n\r\n  get root() {\r\n    return this._root;\r\n  }\r\n  get headerEl() {\r\n    return this._headerEl;\r\n  }\r\n  get contentFrameContainerEl() {\r\n    return this._contentFrameContainerEl;\r\n  }\r\n  get toggleEl() {\r\n    return this._toggleEl;\r\n  }\r\n  get closeEl() {\r\n    return this._closeEl;\r\n  }\r\n  get presenceEl() {\r\n    return this._presenceEl;\r\n  }\r\n  get contentFrameEl() {\r\n    return this._contentFrameEl;\r\n  }\r\n  get minTranslateX() {\r\n    return this._minTranslateX;\r\n  }\r\n  get translateX() {\r\n    return this._translateX;\r\n  }\r\n  get translateY() {\r\n    return this._translateY;\r\n  }\r\n  get appWidth() {\r\n    return this._appWidth;\r\n  }\r\n  get appHeight() {\r\n    return this._appHeight;\r\n  }\r\n  get dragStartPosition() {\r\n    return this._dragStartPosition;\r\n  }\r\n\r\n  get closed() {\r\n    return this._closed;\r\n  }\r\n  get minimized() {\r\n    return this._minimized;\r\n  }\r\n  get dragging() {\r\n    return this._dragging;\r\n  }\r\n  get hover() {\r\n    return this._hover;\r\n  }\r\n  get loading() {\r\n    return this._loading;\r\n  }\r\n  get userStatus() {\r\n    return this._userStatus;\r\n  }\r\n  get dndStatus() {\r\n    return this._dndStatus;\r\n  }\r\n}\r\n"]}