{"version":3,"sources":["lib/ProxyFrameController/index.js"],"names":["ProxyFrameController","prefix","parse","window","location","href","query","uuid","addEventListener","data","oAuthUri","search","parsedUri","uri","format","state","undefined","key","e","newValue","callbackUri","parent","postMessage","localStorage","removeItem","proxyLoaded"],"mappings":";;;;;;;;;;;;;;;;;;;AAAA;;;;AACA;;;;;;IAEqBA,oB,GACnB,gCAEQ;AAAA,iFAAJ,EAAI;AAAA,MADNC,MACM,QADNA,MACM;;AAAA;;AAAA,mBAKF,cAAIC,KAAJ,CAAUC,OAAOC,QAAP,CAAgBC,IAA1B,EAAgC,IAAhC,CALE;AAAA,yCAEJC,KAFI,CAGFC,IAHE;AAAA,MAGFA,IAHE,yCAGK,EAHL;;AAON;AACA;AACA;AACA;AACA;;AAEAJ,SAAOK,gBAAP,CAAwB,SAAxB,EAAmC,iBAAc;AAAA,QAAXC,IAAW,SAAXA,IAAW;;AAC/C,QAAIA,IAAJ,EAAU;AAAA,UAENC,QAFM,GAGJD,IAHI,CAENC,QAFM;;;AAKR,UAAIA,YAAY,IAAhB,EAAsB;AAAA,0BAKhB,cAAIR,KAAJ,CAAUQ,QAAV,EAAoB,IAApB,CALgB;AAAA,YAElBJ,KAFkB,eAElBA,KAFkB;AAAA,YAGlBK,MAHkB,eAGlBA,MAHkB;AAAA,YAIfC,SAJe;;AAMpB,YAAMC,MAAM,cAAIC,MAAJ,4BACPF,SADO;AAEVN,4CACKA,KADL;AAEES,mBAAUT,MAAMS,KAAhB,SAAyBR;AAF3B,YAFU;AAMVI,kBAAQK;AANE,WAAZ;AAQA,iCAAUH,GAAV,EAAkBZ,MAAlB,aAAkC,GAAlC,EAAuC,GAAvC;AACD;AACF;AACF,GAvBD;;AAyBA,MAAMgB,MAAShB,MAAT,SAAmBM,IAAnB,0BAAN;AACAJ,SAAOK,gBAAP,CAAwB,SAAxB,EAAmC,UAACU,CAAD,EAAO;AACxC,QAAIA,EAAED,GAAF,KAAUA,GAAV,IAAiBC,EAAEC,QAAnB,IAA+BD,EAAEC,QAAF,KAAe,EAAlD,EAAsD;AACpD,UAAMC,cAAcF,EAAEC,QAAtB;AACAhB,aAAOkB,MAAP,CAAcC,WAAd,CAA0B;AACxBF;AADwB,OAA1B,EAEG,GAFH;AAGAG,mBAAaC,UAAb,CAAwBP,GAAxB;AACD;AACF,GARD;AASA;AACAd,SAAOkB,MAAP,CAAcC,WAAd,CAA0B;AACxBG,iBAAa;AADW,GAA1B,EAEG,GAFH;AAGD,C;;kBAvDkBzB,oB","file":"index.js","sourcesContent":["import url from 'url';\r\nimport popWindow from '../popWindow';\r\n\r\nexport default class ProxyFrameController {\r\n  constructor({\r\n    prefix,\r\n  } = {}) {\r\n    const {\r\n      query: {\r\n        uuid = '',\r\n      },\r\n    } = url.parse(window.location.href, true);\r\n\r\n    // window.oAuthCallback = (callbackUri) => {\r\n    //   window.parent.postMessage({\r\n    //     callbackUri,\r\n    //   }, '*');\r\n    // };\r\n\r\n    window.addEventListener('message', ({ data }) => {\r\n      if (data) {\r\n        const {\r\n          oAuthUri,\r\n        } = data;\r\n\r\n        if (oAuthUri != null) {\r\n          const {\r\n            query,\r\n            search,\r\n            ...parsedUri,\r\n          } = url.parse(oAuthUri, true);\r\n          const uri = url.format({\r\n            ...parsedUri,\r\n            query: {\r\n              ...query,\r\n              state: `${query.state}-${uuid}`,\r\n            },\r\n            search: undefined,\r\n          });\r\n          popWindow(uri, `${prefix}-oauth`, 600, 600);\r\n        }\r\n      }\r\n    });\r\n\r\n    const key = `${prefix}-${uuid}-redirect-callbackUri`;\r\n    window.addEventListener('storage', (e) => {\r\n      if (e.key === key && e.newValue && e.newValue !== '') {\r\n        const callbackUri = e.newValue;\r\n        window.parent.postMessage({\r\n          callbackUri,\r\n        }, '*');\r\n        localStorage.removeItem(key);\r\n      }\r\n    });\r\n    // loaded\r\n    window.parent.postMessage({\r\n      proxyLoaded: true,\r\n    }, '*');\r\n  }\r\n}\r\n"]}