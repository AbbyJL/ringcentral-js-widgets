<!DOCTYPE html>
<html>

<head>
    <title>RingCentral Web Phone</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="normalize.css">
    <link rel="stylesheet" type="text/css" href="main.css">
    <link rel="stylesheet" type="text/css" href="theme/basic.css" id="theme-css">
    <style type="text/css">
    body {
        max-width: 250px;
    }
    
    .theme-panel {
        margin-bottom: 10px;
    }
    
    .theme-button {
        border: 0;
        width: 20px;
        height: 20px;
        border: 1px solid;
    }
    
    #theme-basic {
        background-color: #fff;
        border-color: #000;
    }
    
    #theme-blue {
        background-color: #3498db;
    }
    
    #theme-casual {
        background-color: #95a5a6;
    }
    </style>
</head>

<body>
    <div class='theme-panel'>
        Theme:
        <button class='theme-button' id='theme-basic' onclick="switchTheme('basic')"></button>
        <button class='theme-button' id='theme-blue' onclick="switchTheme('blue')"></button>
        <button class='theme-button' id='theme-casual' onclick="switchTheme('casual')"></button>
    </div>
    <div>
        <div id="auth-panel"></div>
        <div id="dial-pad"></div>
        <div id="call-panel"></div>
    </div>
    <script type="text/javascript" src="../bower_components/ringcentral/build/ringcentral-bundle.js"></script>
    <script type="text/javascript" src="../bower_components/ringcentral-web-phone/build/ringcentral-web-phone.js"></script>
    <script type="text/javascript" src="../build/build.js"></script>
    <script type="text/javascript">
    var authPanel = new AuthPanel({
        template: './template/auth-panel.html',
        actions: {
            login: function(props) {
                return rcHelper.login(props);
            },
        },
        handlers: {},
        beforeUpdate: function(action, props) {
            return true;
        },
        afterUpdate: function(action, props) {
            if (action === 'login') {
                console.log('user after login');
                dialPad.render('#dial-pad', function() {
                    authPanel.remove();
                })
            }
            return true;
        }
    });
    var dialPad = new DialPad({
        template: './template/dial-pad.html',
        actions: {
            callout: function(props) {
                return rcHelper.callout(props);
            }
        },
        handlers: {},
        beforeUpdate: function(action, props) {
            return true;
        },
        afterUpdate: function(action, props) {
            if (action === 'callout') {
                callPanel.render('#call-panel');
            }
            return true;
        }
    });
    var callPanel = new CallPanel({
        template: './template/call-panel.html',
        actions: {
            answer: function(props) {
                return rcHelper.answer(props);
            },
            ignore: function(props) {
                return rcHelper.ignore(props);
            },
            cancel: function(props) {
                return rcHelper.cancel(props);
            },
            hangup: function(props) {
                return rcHelper.hangup(props);
            },
            record: function(props) {
                return rcHelper.record(props);
            },
            hold: function(props) {
                return rcHelper.hold(props);
            },
            mute: function(props) {
                return rcHelper.mute(props);
            },
        },
        handlers: {
            called: function(handler) {
                rcHelper.called(handler);
            },
            callStarted: function(handler) {
                rcHelper.callStarted(handler);
            },
            callRejected: function(handler) {
                rcHelper.callRejected(handler);
            },
            callEnded: function(handler) {
                rcHelper.callEnded(handler);
            },
            callFailed: function(handler) {
                rcHelper.callFailed(handler);
            }
        },
        beforeUpdate: function(action, props) {
            return true;
        },
        afterUpdate: function(action, props) {
            if (action === 'mount') {
                rcHelper.initPhoneListener(props);
            }
            return true;
        }
    });
    // render is async, supports both callbacks and promises
    authPanel.render('#auth-panel', function() { /* ... */ });

    function switchTheme(theme) {
        document.getElementById('theme-css').href = 'theme/' + theme + '.css';
    }
    </script>
</body>

</html>
