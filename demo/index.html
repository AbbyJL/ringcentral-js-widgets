<!DOCTYPE html>
<html>

<head>
    <title>RingCentral Web Phone</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="../src/styles/normalize.css">
    <link rel="stylesheet" type="text/css" href="../src/styles/main.css">
    <link rel="stylesheet" type="text/css" href="../styles/call-log.css">
    <link rel="stylesheet" type="text/css" href="theme/basic.css" id="theme-css">
    <style type="text/css">
    body {
        max-width: 250px;
    }
    
    .theme-panel {
        margin-bottom: 10px;
    }
    
    .theme-button {
        border: 0;
        width: 20px;
        height: 20px;
        border: 1px solid;
    }
    
    #theme-basic {
        background-color: #fff;
        border-color: #000;
    }
    
    #theme-blue {
        background-color: #3498db;
    }
    
    #theme-casual {
        background-color: #95a5a6;
    }
    </style>
</head>

<body>
    <div class='theme-panel'>
        Theme:
        <button class='theme-button' id='theme-basic' onclick="switchTheme('basic')"></button>
        <button class='theme-button' id='theme-blue' onclick="switchTheme('blue')"></button>
        <button class='theme-button' id='theme-casual' onclick="switchTheme('casual')"></button>
    </div>
    <div>
        <div id="auth-panel"></div>
        <div id="dial-pad"></div>
        <div id="call-panel"></div>
        <div id="call-log-panel"></div>
    </div>
    <script type="text/javascript" src="../bower_components/ringcentral/build/ringcentral-bundle.js"></script>
    <script type="text/javascript" src="../bower_components/ringcentral-web-phone/build/ringcentral-web-phone.js"></script>
    <script type="text/javascript" src="../build/build.js"></script>
    <script type="text/javascript">
    var authPanel = new AuthPanel({
        template: '../template/auth-panel.html',
        actions: {
            init: {
                before: function() {},
                method: function() {
                },
                after: function() {}
            },
            render: {
                before: function() {},
                method: function() {
                },
                after: function() {}
            },
            login: {
                before: function() {
                },
                method: function() {
                    var username = this.props.dom.username.value;
                    var extension = this.props.dom.extension.value;
                    var password = this.props.dom.password.value;
                    return LoginService.login(username, extension, password);
                },
                after: function() {
                    dialPad.render('#dial-pad');
                }
            }
        },
        handlers: {},
    });
    var dialPad = new DialPad({
        template: '../template/dial-pad.html',
        actions: {
            init: {
                before: function() {},
                method: function() {},
                after: function() {}
            },
            render: {
                before: function() {},
                method: function() {},
                after: function() {}
            },
            callout: {
                before: function() {},
                method: function() {
                    var toNumber = this.props.toNumber;
                    var fromNumber = this.props.fromNumber;
                    return PhoneService.callout(fromNumber, toNumber);
                },
                after: function() {}
            },
            getCandidates: {
                before: function() {},
                method: function() {
                    return rcHelper.getCandidates(this.props);
                },
                after: function() {}

            }
        },
        handlers: {},
    });
    authPanel.render('#auth-panel');


    //
    // var callPanel = new CallPanel({
    //     template: '../template/call-panel.html',
    //     actions: {
    //         answer: function() {
    //             return PhoneService.answer(this.props);
    //         },
    //         ignore: function() {
    //             return PhoneService.ignore(this.props);
    //         },
    //         cancel: function() {
    //             return PhoneService.cancel(this.props);
    //         },
    //         hangup: function() {
    //             return PhoneService.hangup(this.props);
    //         },
    //         record: function() {
    //             return PhoneService.record(this.props);
    //         },
    //         hold: function() {
    //             return PhoneService.hold(this.props);
    //         },
    //         mute: function() {
    //             return PhoneService.mute(this.props);
    //         },
    //     },
    //     handlers: {
    //         called: function(handler) {
    //             PhoneService.called(handler);
    //         },
    //         callStarted: function(handler) {
    //             PhoneService.callStarted(handler);
    //         },
    //         callRejected: function(handler) {
    //             PhoneService.callRejected(handler);
    //         },
    //         callEnded: function(handler) {
    //             PhoneService.callEnded(handler);
    //         },
    //         callFailed: function(handler) {
    //             PhoneService.callFailed(handler);
    //         }
    //     },
    //     beforeUpdate: function(action) {
    //         return true;
    //     },
    //     afterUpdate: function(action) {
    //         if (action === 'mount') {
    //             PhoneService.initPhoneListener(this.props);
    //         }
    //         return true;
    //     }
    // });


    LoginService.registerLoginHandler(function() {
        PhoneService.registerSIP();
        CallLogService.getCallLogs();

    });

    // var callLog = new CallLog({
    //     template:'../template/call-log.html',
    //     actions:{
    //         enableAllCallTab:function(){},
    //         enableMissedCallTab:function(){}
    //     },
    //     handlers:{

    //         logUpdated:function(handler){
    //             CallLogService.registerCallLogUpdatedHandler(handler);
    //         }

    //     }

    // });

    // LoginService.checkLoginStatus().then(

    //     function(isLoggedIn) {
    //         if (isLoggedIn) {

    //             callPanel.render('#call-panel');
    //             dialPad.render('#dial-pad');
    //             callLog.render('#call-log-panel');

    //         } else {
    //             // render is async, supports both callbacks and promises
    //             authPanel.render('#auth-panel', function() { /* ... */ });
    //         }
    //     }

    // );

    function switchTheme(theme) {
        document.getElementById('theme-css').href = 'theme/' + theme + '.css';
    }
    </script>
</body>

</html>
