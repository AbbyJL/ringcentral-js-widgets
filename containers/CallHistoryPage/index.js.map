{"version":3,"sources":["containers/CallHistoryPage/index.js"],"names":["mapToProps","_","phone","locale","brand","callHistory","regionSettings","connectivityMonitor","rateLimiter","dateTimeFormat","callLogger","call","composeText","rolesAndPermissions","enableContactFallback","fullName","title","getString","currentLocale","calls","areaCode","countryCode","disableLinks","connectivity","throttling","disableClickToDial","isIdle","outboundSmsPermission","permissions","OutboundSMS","internalSmsPermission","InternalSMS","loggingMap","showSpinner","ready","autoLog","mapToFunctions","contactMatcher","routerInteraction","contactSearch","onCreateContact","dateTimeFormatter","utcTimestamp","formatDateTime","onLogCall","isLoggedContact","dialerRoute","composeTextRoute","onViewContact","contact","id","type","push","phoneNumber","name","entityType","hasMatchNumber","ignoreCache","forceMatchNumber","undefined","onClickToDial","onToNumberChange","onCall","onClickToSms","isDummyContact","updateTypingToNumber","search","searchString","addToNumber","typingToNumber","cleanTypingToNumber","redirect","logCall","CallsPage"],"mappings":"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","file":"index.js","sourcesContent":["import { connect } from 'react-redux';\nimport CallsPanel from '../../components/CallsPanel';\nimport withPhone from '../../lib/withPhone';\nimport i18n from './i18n';\n\nfunction mapToProps(_, {\n  phone: {\n    locale,\n  brand,\n  callHistory,\n  regionSettings,\n  connectivityMonitor,\n  rateLimiter,\n  dateTimeFormat,\n  callLogger,\n  call,\n  composeText,\n  rolesAndPermissions,\n  },\n  enableContactFallback = false,\n}) {\n  return {\n    enableContactFallback,\n    brand: brand.fullName,\n    title: i18n.getString('title', locale.currentLocale),\n    currentLocale: locale.currentLocale,\n    calls: callHistory.calls,\n    areaCode: regionSettings.areaCode,\n    countryCode: regionSettings.countryCode,\n    disableLinks: !connectivityMonitor.connectivity ||\n      rateLimiter.throttling,\n    disableClickToDial: !(call && call.isIdle),\n    outboundSmsPermission: !!(\n      rolesAndPermissions.permissions &&\n      rolesAndPermissions.permissions.OutboundSMS\n    ),\n    internalSmsPermission: !!(\n      rolesAndPermissions.permissions &&\n      rolesAndPermissions.permissions.InternalSMS\n    ),\n    loggingMap: (callLogger && callLogger.loggingMap),\n    showSpinner: !(\n      callHistory.ready &&\n      locale.ready &&\n      regionSettings.ready &&\n      dateTimeFormat.ready &&\n      connectivityMonitor.ready &&\n      (!rolesAndPermissions || rolesAndPermissions.ready) &&\n      (!call || call.ready) &&\n      (!composeText || composeText.ready) &&\n      (!callLogger || callLogger.ready)\n    ),\n    autoLog: !!(callLogger && callLogger.autoLog),\n  };\n}\nfunction mapToFunctions(_, {\n  phone: {\n    dateTimeFormat,\n    callLogger,\n    contactMatcher,\n    call,\n    composeText,\n    routerInteraction,\n    contactSearch,\n  },\n  onCreateContact,\n  dateTimeFormatter = ({ utcTimestamp }) => dateTimeFormat.formatDateTime({\n    utcTimestamp,\n  }),\n  onLogCall,\n  isLoggedContact,\n  dialerRoute = '/dialer',\n  composeTextRoute = '/composeText',\n  onViewContact,\n}) {\n  return {\n    dateTimeFormatter,\n    onViewContact: onViewContact || (({ contact }) => {\n      const id = contact.id;\n      const type = contact.type;\n      routerInteraction.push(`/contacts/${type}/${id}?direct=true`);\n    }),\n    onCreateContact: onCreateContact ?\n      async ({ phoneNumber, name, entityType }) => {\n        const hasMatchNumber = await contactMatcher.hasMatchNumber({\n          phoneNumber,\n          ignoreCache: true\n        });\n        // console.debug('confirm hasMatchNumber:', hasMatchNumber);\n        if (!hasMatchNumber) {\n          await onCreateContact({ phoneNumber, name, entityType });\n          await contactMatcher.forceMatchNumber({ phoneNumber });\n        }\n      } :\n      undefined,\n    onClickToDial: call ?\n      (phoneNumber) => {\n        if (call.isIdle) {\n          routerInteraction.push(dialerRoute);\n          call.onToNumberChange(phoneNumber);\n          call.onCall();\n        }\n      } :\n      undefined,\n    onClickToSms: composeText ?\n      async (contact, isDummyContact = false) => {\n        if (routerInteraction) {\n          routerInteraction.push(composeTextRoute);\n        }\n        // if contact autocomplete, if no match fill the number only\n        if (contact.name && contact.phoneNumber && isDummyContact) {\n          composeText.updateTypingToNumber(contact.name);\n          contactSearch.search({ searchString: contact.name });\n        } else {\n          composeText.addToNumber(contact);\n          if (composeText.typingToNumber === contact.phoneNumber) {\n            composeText.cleanTypingToNumber();\n          }\n        }\n      } :\n      undefined,\n    isLoggedContact,\n    onLogCall: onLogCall ||\n      (callLogger && (async ({ call, contact, redirect = true }) => {\n        await callLogger.logCall({\n          call,\n          contact,\n          redirect,\n        });\n      })),\n  };\n}\n\nconst CallsPage = withPhone(connect(mapToProps, mapToFunctions)(CallsPanel));\n\nexport default CallsPage;\n"]}