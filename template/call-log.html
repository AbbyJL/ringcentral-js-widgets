<div>
    <div class="rc-pane-header call-log-header">
            Call Log
    </div>

    <div class="tabs tabs2 badges">
        <a class="tab active" data-info="allCallTab" data-event="click:enableAllCallTab">
            All
        </a>
        <a class="tab" data-info="missedCallTab" data-event="click:enableMissedCallTab">
            Missed
            <!--<span class="badge" ng-if="(counters.calls|removeInboundLeg|filterMissedCalls|filterStarttimeCalls).length">
                {{ (counters.calls|removeInboundLeg|filterMissedCalls|filterStarttimeCalls).length }}
            </span>-->
        </a>
    </div>

    <div class="rc-pane-scrollable" ng-class="{'clearExpanded':!clearCollapsed}">
        <div data-info="logs">
            <call-log-item dynamic ></call-log-item>
        </div>

    </div>
</div>
<script>
w.register(function(){
    
    function createWidgetItems(logItems, props)
    {
        logItems.forEach(function(item){
            var widget = w('call-log-item', {
                actions:{
                    init:{
                        method:function(){
                            return item;
                        }
                    }
                }
            }); 
            widget.render(props.dom.logs);
            props.widgetItems.push(widget);
        });
    }
    
    function filterWidgetItems(widgetItems, filter){
        
        widgetItems.forEach(function(widget){
            
            if(!filter(widget)){
                widget.props.dom.entry.classList.add('hidden');
            }else{
                widget.props.dom.entry.classList.remove('hidden');
            }
            
        });
    }
    
    function enableTab(toEnableTab, toDisableTab){
        if(toEnableTab.classList.contains('active') === false){
            toEnableTab.classList.add('active');
            toDisableTab.classList.remove('active');
        }
    }
    
    
    this.actions = {
        init:{
            before:function(){
                this.props.widgetItems = [];  
            },
            method:function(finish){
                return Promise.resolve(finish()).then(logItems => 
                {
                    this.props.logItems = logItems;
                    return logItems;
                });
            },
            after:function(logItems){
                createWidgetItems(logItems, this.props);
            } 
        },
        enableAllCallTab:{
            after:function(){
                enableTab(this.props.dom.allCallTab, this.props.dom.missedCallTab);
                filterWidgetItems(this.props.widgetItems, function(){return true;});
            }
        },
        enableMissedCallTab:{
            after:function(){
                enableTab(this.props.dom.missedCallTab, this.props.dom.allCallTab);
                filterWidgetItems(this.props.widgetItems, function(widget){
                    
                    if(widget.props.item.result === "Missed"){
                        return true;
                    }else{
                        return false;
                    }
                    
                });
            }
        }
    }
});
</script>