<div class='rc-panel' data-info='root'>
    <div class='rc-pane-header'>
        <h1>Dialer</h1>
    </div>
    <div class='rc-pane-content'>
        <div class='rc-mask display-none' data-info='disabled-mask'>
            <div class='rc-mask-message'>Sorry, your account doesn't not have Web Phone permission.</div>
        </div>
        <div class='rc-pane-scrollable'>
            <dropdown data-info='dropdown'></dropdown>
            <div data-info='number'>
                <contact-picker data-info='contact-picker'></contact-picker>
            </div>
            <div class='rc-dial-wrapper'>
                <button class='rc-dial-button' data-info='dial-button-1' data-value='1' data-event='click:dialing'>1</button>
                <button class='rc-dial-button' data-info='dial-button-2' data-value='2' data-event='click:dialing'>2</button>
                <button class='rc-dial-button' data-info='dial-button-3' data-value='3' data-event='click:dialing'>3</button>
                <button class='rc-dial-button' data-info='dial-button-4' data-value='4' data-event='click:dialing'>4</button>
                <button class='rc-dial-button' data-info='dial-button-5' data-value='5' data-event='click:dialing'>5</button>
                <button class='rc-dial-button' data-info='dial-button-6' data-value='6' data-event='click:dialing'>6</button>
                <button class='rc-dial-button' data-info='dial-button-7' data-value='7' data-event='click:dialing'>7</button>
                <button class='rc-dial-button' data-info='dial-button-8' data-value='8' data-event='click:dialing'>8</button>
                <button class='rc-dial-button' data-info='dial-button-9' data-value='9' data-event='click:dialing'>9</button>
                <button class='rc-dial-button' data-info='dial-button-0' data-value='0' data-event='click:dialing'>0</button>
            </div>
            <button class='rc-button' data-info='callout' data-event='click:callout'>Call</button>
            <div class='rc-error-message' data-info='error'></div>
        </div>
    </div>
    <div class='rc-pane-footer'></div>
</div>
<script>
w.register(function() {
    this.actions = w.action('interaction');
    this.actions.init = {
        before: function() {},
        method: function() {},
        after: function() {
            var dialPad = this;
            w.customize(this, 'contact-picker', {
                actions: {
                    autoComplete: {
                        method: function() {
                            return dialPad.queryContacts(this.props.inputValue);
                        }
                    }
                }
            })
            w.customize(this, 'dropdown', {
                actions: {
                    getData: {
                        method: function() {
                            return dialPad.getOutboundCallerID();
                        },
                        after: function(ids) {
                            ids.forEach(id => this.addItem(id));
                        }
                    },
                    switchTitle: {
                        method: function(text) {
                            dialPad.props.fromNumber = text;
                        }
                    }
                }
            })
        }
    }
    this.actions.render = {
        before: function() {},
        method: function() {},
        after: function() {
            this.props['dropdown'].getData();
        }
    }
    this.actions.dialing = {
        method: function(finish) {
            var button = event.target;
            var cp = this.props['contact-picker'];
            cp.appendInput(button.getAttribute('data-value'));
            return finish();
        },
        after: function() {
            this.props['contact-picker'].props.dom.input.focus();
        }
    }
    this.actions.callout = {
        before: function() {
            this.props.dom.callout.classList.add('rc-button-loading');
        },
        method: function(finish) {
            var ac = this.props['contact-picker'];
            this.props.toNumber = ac.props.dom.input.value;
            this.props.fromNumber = localStorage.getItem('username');
            return finish(this.props.fromNumber, this.props.toNumber);
        },
        after: function() {},
        error: function(err) {
            this.props.dom.error.textContent = err.message;
        }
    }
    this.actions.disable = {
        method: function(finish) {
            return finish();
        },
        after: function() {
            this.props.dom['disabled-mask'].classList.remove('display-none');
        }
    }
    this.actions.getOutboundCallerID = {
        method: function(finish) {
            return finish();
        }
    }
    this.actions.queryContacts = {
        method: function(finish, queryText) {
            this.props.to = queryText;
            return finish();
        }
    }
})
</script>
